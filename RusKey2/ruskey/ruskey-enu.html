<!--------------------------------------------------------------------------->
<!--                           INTRODUCTION                                

 The Code Project article submission template (HTML version)

Using this template will help us post your article sooner. To use, just 
follow the 3 easy steps below:
 
     1. Fill in the article description details
     2. Add links to your images and downloads
     3. Include the main article text

That's all there is to it! All formatting will be done by our submission
scripts and style sheets. 

-->
<!--------------------------------------------------------------------------->
<!--                        IGNORE THIS SECTION                            -->
<html>
   <head>
      <title>The Code Project</title>
      <style> BODY, P, TD { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt }
	H2,H3,H4,H5 { color: #ff9900; font-weight: bold; }
	H2 { font-size: 13pt; }
	H3 { font-size: 12pt; }
	H4 { font-size: 10pt; color: black; }
	PRE { BACKGROUND-COLOR: #FBEDBB; FONT-FAMILY: "Courier New", Courier, mono; WHITE-SPACE: pre; }
	CODE { COLOR: #990000; FONT-FAMILY: "Courier New", Courier, mono; }
	</style>
      <link rel="stylesheet" type="text/css" href="http://www.codeproject.com/styles/global.css">
   </head>
   <body bgcolor="#ffffff" color="#000000">
      <!--------------------------------------------------------------------------->
      <!-------------------------------     STEP 1      --------------------------->
      <!--  Fill in the details (CodeProject will reformat this section for you) -->
      <pre>
Title:       RusKey: mapping the Russian keyboard layout into the Latin alphabet
Author:      Wanderley Caloni
Email:       wanderley@caloni.com.br
Environment: VC++ 7.1, WinXP SP2
Keywords:    C++
Level:       Beginner
Description: How to replace characters while typing.
Section      C++
SubSection   General
</pre>
      <!-------------------------------     STEP 2      --------------------------->
      <!--  Include download and sample image information.                       -->
      <ul class="download">
         <li>
            <a href="ruskey_src.zip">Download source - XXX Kb</a></li>
      </ul>
      <!-------------------------------     STEP 3      --------------------------->
      <!--  Add the article text. Please use simple formatting (<h2>, <p> etc)   -->
      <h2>Introduction</h2>
      <P>Using a very simple hook you can change the meaning of what the user is typing 
         and put&nbsp;anything else. The process is even easier if what you want is to 
         replace one by one the characters typed.</P>
      <P>
         This is a very simple program that uses this technique to make the Russian 
         keyboard layout easy to learn. I made it for myself, but maybe it can be useful 
         for anyone else. At least the&nbsp;hook technique, flexible enough, is 
         worthy&nbsp;to learn.</P>
      <H2>Why to map characters</H2>
      <P><!--StartFragment --> An alphabet is one of the many ways to represent the 
         words of a language in writing. A wrote word is a set of letters&nbsp;meaning 
         the sounds we use to&nbsp;pronounce this word. Every different sound is a 
         different <A href="http://en.wikipedia.org/wiki/Phoneme">phoneme</A>.</P>
      <P><!--StartFragment --> In this case, even the Russian alphabet&nbsp;being 
         so&nbsp;different from the Latin alphabet, both share many phonemes. This means 
         that we can get some Cyrillic letters and&nbsp;replace&nbsp;them 
         directly&nbsp;to some&nbsp;Latin letters. However, after the translation, the 
         position of this letter normally is different from the Latin keyboard layout. 
         So we have a Latin letter in a different place in the keyboard. If made a near 
         translation between the both, the Latin letters will be disposed like this:</P>
      <P><IMG height="225" alt="Latin phonemes inside the russian keyboard layout" src="ruskey/Keyboard_Layout_Russian.png"
            width="540"></P>
      <P>Is&nbsp;a bit different from the&nbsp;well-known <I><STRONG>qwert asdfg, </STRONG>isn't</I>?</P>
      <P>When typing using this pseudo-keyboard layout the Latin layout is replaced for 
         the Russian layout in a Latin letters set. So the person can&nbsp;to practice 
         Russian keyboard <STRONG>even</STRONG> using the Latin alphabet. Cool, isn't? I 
         can to code using the misplaced letters, because the final result is the 
         same.&nbsp;I just need train my fingers to beat the same letters in different 
         places. This way,&nbsp;if I would need to use Cyrillic, I already know where 
         every Russian letters is supposed to be in the Russian keyboard.</P>
      <P>Obs: Almost all the Russian letters can be&nbsp;replaced using a Latin one, but 
         there's some exceptions. So I choose to ignore the translation in this case and 
         put another letter instead. It is&nbsp;not necessarily a good choice for the 
         phoneme, but&nbsp;required in order&nbsp;to write&nbsp;using all the available 
         Latin letters.</P>
      <h2>
         Background</h2>
      <p>It would be nice to know something about the Win32 API function <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/hooks/hookreference/hookfunctions/setwindowshookex.asp">
            SetWindowsHookEx()</A> and how to use it for message hooks.
         <h2>Using the code</h2>
      <P>The code itself is already a useful program (at least for me +). You can use it 
         for typing training in another keyboard layout systems. The only thing to 
         change inside the code is the&nbsp;correspondence of the letters, located 
         inside both arrays below:</P>
      <PRE>const TCHAR g_tzRussAlphabet[] = _T("F&lt;RLTAU{B:RKVYJGSHCNED}IOPf,rltau[b;rkvyjgshcned]iop");
const TCHAR g_tzPortAlphabet[] = _T("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");</PRE>
      <P>
         The&nbsp;handling code is quite simple. It is about an original charset array 
         search and consequent replace for its Latin brother (the same index inside the 
         another array):</P>
      <PRE>      switch( pMsg-&gt;message )
      {
         case WM_CHAR:
         {
            LPTSTR ptzChar = 
               _tcschr(g_tzRussAlphabet, (TCHAR) pMsg-&gt;wParam);

            if( ptzChar )
            {
               size_t offset = ptzChar - g_tzRussAlphabet;
               pMsg-&gt;wParam = (WPARAM) g_tzPortAlphabet[offset];
            }
         }
      }</PRE>
      <h2>Points of Interest</h2>
      <P>While debugging a project that makes message hooks globally the attention must 
         be multiplied for three times or more. Any mistake you do inside the callback 
         function can put the system down (like a <code>MessageBox()</code> called for 
         any message, by example). However once you're debugging a specific message for 
         a specific process, generally the only&nbsp;processes will freeze will be 
         the&nbsp;debuggee itself and the ones that depends&nbsp;directly on some froze 
         action. 
         <!-------------------------------    That's it!   ---------------------------></P>
   </body>
</html>
