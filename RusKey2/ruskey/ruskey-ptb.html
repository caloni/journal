<!--------------------------------------------------------------------------->
<!--                           INTRODUÇÃO                                     

 Modelo de Submissão de Artigo The Code Project (versão HTML, Port. Brasil)

Usando esse modelo você irá nos ajudar a publicar seu artigo o quanto antes.
Para usá-lo, basta seguir os 3 passos descritos abaixo:
 
     1. Preencha os detalhes do artigo
     2. Adicione links para suas imagens e downloads
     3. Inclua o texto principal do artigo

Isso é tudo que se tem que fazer! Toda formatação será feita por nossos 
scripts de submissão e folhas de estilo.

-->
<!--------------------------------------------------------------------------->
<!--                        IGNORE ESTA SEÇÃO                              --><html><head>
      <title>The Code Project</title>
      <style> BODY, P, TD { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt }
	H2,H3,H4,H5 { color: #ff9900; font-weight: bold; }
	H2 { font-size: 13pt; }
	H3 { font-size: 12pt; }
	H4 { font-size: 10pt; color: black; }
	PRE { BACKGROUND-COLOR: #FBEDBB; FONT-FAMILY: "Courier New", Courier, mono; WHITE-SPACE: pre; }
	CODE { COLOR: #990000; FONT-FAMILY: "Courier New", Courier, mono; }
	</style>
      <link href="http://www.codeproject.com/styles/global.css" type="text/css" rel="stylesheet"></head>
   <body bgColor="#ffffff" color="#000000">
      <!--------------------------------------------------------------------------->
      <!-------------------------------     PASSO 1      -------------------------->
      <!--  Preencha os detalhes (O CodeProject irá reformatá-los para você)     -->
      <pre>Título:           RusKey: mapeando o layout do teclado russo com o alfabeto latino
Autor:            Wanderley Caloni
Email:            wanderley@caloni.com.br
Ambiente:         VC++ 7.1, WinXP SP2
Palavras-Chave:   C++
Nível:            Básico
Descrição:        Como substituir caracteres durante a digitação.
Seção             C++
Sub-Seção         Geral
</pre>
      <!-------------------------------     PASSO 2      -------------------------->
      <!--  Inclua informações de download e imagens de exemplo.                 -->
      <ul class="download">
         <li>
            <A href="ruskey_src.zip">Download dos fontes - XXX Kb</A>
         </li>
      </ul>
      <!-------------------------------     PASSO 3      -------------------------->
      <!--  Adicione o texto do artigo. Por favor use formatação simples         -->
      <h2>Introdução</h2>
      <p>Com o uso de um hook muito simples, pode-se alterar o significado do que se 
         digita no teclado por qualquer outra coisa. O processo é mais fácil ainda 
         quando o que se quer é uma correspondência numérica exata entre quantas letras 
         foram digitadas e quantos caracteres aparecerão para o usuário.</p>
      <P>Este é um programa muito simples que se utiliza dessa técnica para facilitar o 
         aprendizado do layout de um teclado russo. Fiz para uso próprio, mas quem sabe 
         não pode ser útil para mais alguém? Pelo menos a técnica de hook, se usada com 
         criatividade, já é uma coisa que vale a pena aprender.</P>
      <H2>Por que mapear caracteres</H2>
      <P><!--StartFragment --> Um alfabeto é uma das muitas maneiras de representar as 
         palavras de uma língua por escrito. Uma palavra escrita é um conjunto de letras 
         que representa os sons que usamos para falar essa palavra. Cada som usado é 
         chamado de <A href="http://en.wikipedia.org/wiki/Phoneme">fonema</A>.</P>
      <P><!--StartFragment --> Assim sendo, embora o alfabeto russo seja diferente do 
         alfabeto latino muitos fonemas são compartilhados. Isso quer dizer que podemos 
         pegar algumas letras do cirílico e traduzir diretamente para algumas letras do 
         nosso alfabeto, e outras letras não. Porém, após a tradução de uma letra no 
         teclado, a posição dela geralmente não é a mesma posição do nosso teclado. Daí 
         temos uma letra de nosso alfabeto em outro lugar. Se for feita uma tradução 
         aproximada entre os dois alfabetos, nossas letras em um teclado russo ficariam 
         dispostas assim:</P>
      <P><IMG height="225" alt="Latin phonemes inside the russian keyboard layout" src="ruskey/Keyboard_Layout_Russian.png"
            width="540"></P>
      <P>Um pouco diferente do <I><STRONG>qwert asdfg</STRONG></I> ao qual estamos 
         acostumados, né?</P>
      <P>Ao digitar usando esse pseudo-layout o treino do layout do teclado russo 
         estaria sendo feito <B>mesmo</B> escrevendo com o alfabeto latino. Legal, não? 
         Poderia programar com as letras todas trocadas, porque a saída final é a mesma. 
         Basta treinar os dedos para acertarem as mesmas letras nos novos lugares. 
         Assim, quando precisasse escrever no alfabeto cirílico saberia melhor onde cada 
         letra fica.</P>
      <P>Obs: Embora a maioria das letras consiga ser representada por uma "equivalente" 
         latina com outras&nbsp;isso não ocorre. Daí optei por ignorar a tradução e 
         colocar uma outra letra que não necessariamente é uma boa tradução do 
         fonema&nbsp;(mas&nbsp;necessária para que se consiga digitar um texto em 
         alfabeto latino).</P>
      <h2>Conhecimento Prévio</h2>
      <p>Seria interessante já ter ouvido falar da função <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/hooks/hookreference/hookfunctions/setwindowshookex.asp">
            SetWindowsHookEx()</A> da API do Windows e seu uso para hook de mensagens.</p>
      <h2>Usando o código</h2>
      <p>O código já é um programa por si só. Pode ser utilizado para 
         treinamentos&nbsp;de digitação em outros sistemas de layout de teclado. A única 
         coisa a ser trocada é a correspondência entre as letras, contidas nos dois 
         arrays abaixo:</p>
      <pre>const TCHAR g_tzRussAlphabet[] = _T("F&lt;RLTAU{B:RKVYJGSHCNED}IOPf,rltau[b;rkvyjgshcned]iop");
const TCHAR g_tzPortAlphabet[] = _T("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");</pre>
      <p>O código de substituição de caracteres é extremamente simples. Se trata de uma 
         busca no array de caracteres originais e posterior substituição do caractere 
         pelo seu equivalente (mesmo índice) no array de caracteres de substituição:</p>
      <pre>      switch( pMsg-&gt;message )
      {
         case WM_CHAR:
         {
            LPTSTR ptzChar = 
               _tcschr(g_tzRussAlphabet, (TCHAR) pMsg-&gt;wParam);

            if( ptzChar )
            {
               size_t offset = ptzChar - g_tzRussAlphabet;
               pMsg-&gt;wParam = (WPARAM) g_tzPortAlphabet[offset];
            }
         }
      }</pre>
      <h2>Pontos de Interesse</h2>
      <p>Durante&nbsp;a depuração de um projeto que faz hook de mensagens global, a 
         atenção merece ser&nbsp;triplicada. Qualquer besteira feita na função de 
         tratamento pode&nbsp;colocar o sistema abaixo (como um <code>MessageBox()</code>
         chamado&nbsp;para qualquer mensagem, por exemplo). No entanto, uma vez que você 
         está depurando uma interceptação de mensagem em um processo 
         distinto,&nbsp;geralmente a única coisa que irá travar será esse processo e os 
         que dele dependerem diretamente.</p>
      <!-------------------------------    É isso aí!   --------------------------->
   </body>
</html>
