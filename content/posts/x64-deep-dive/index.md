---
categories:
- reading
date: '2023-03-29T21:02:57-02:00'
draft: true
link: https://codemachine.com/articles/x64_deep_dive.html
tags: null
title: X64 Deep Dive
---

Recomento esta leitura para se habituar às idiossincrasias sobre o formato assembly do x64, especialmente se você costuma depurar assembly para Windows. O artigo cobre as novas features para suportar 64 bits do formato do executável Windows, o Portable Executable, além de explicar em detalhes o funcionamento de mecanismos que mudaram, como o tratamento de exceção (e o unwinding no código).

# Recortes

> On X64, the first 4 parameters are always passed in registers and the rest of the parameters are passed via the stack. This is one of main causes of grief during debugging since register values tend to change as functions execute and it becomes difficult to determine the original parameter values that were passed to a function, half-way into its execution. Other than this one issue with retrieving parameters, x64 debugging is not that different from x86 debugging.

> Unfortunately, there is no silver bullet to finding parameters. All the techniques here depend heavily on the X64 assembler instructions generated by the compiler. If the parameters are not in "reachable memory", there is simply no way to get them. Having private symbols for modules and functions that appear in the call stack doesn't help too much either. Private symbols do tell the number and types of parameters a function takes, but that's about it. It does not tell what those parameter values are. 

>
> Determine if the parameters are loaded from non-volatile registers and if those registers are saved by the callee. 
>
> Determine if the parameters are saved from the registers into memory. 
>
> Determine if the parameters are saved into non-volatile registers and if those registers are saved by the callee. 
>
> Each one of the techniques requires disassembling the caller and the callee functions involved in the parameter passing. 
>

> The debugger's ".frame /r" command displays the values of non-volatile registers when a particular function was executing. 

> it is important to always verify parameter register overwrites 

> It is important to examine the instructions up to the call to the next function (...) to ascertain that these non-volatile registers are not being overwritten. 
